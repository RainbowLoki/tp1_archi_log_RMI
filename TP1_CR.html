<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="hai704l---architectures-logicielles-distribuées">HAI704L - Architectures logicielles distribuées</h1>
<h1 id="tp1---compte-rendu">TP1 - Compte Rendu</h1>
<h5 id="par-arthur-sapin-et-wided-meflah">Par Arthur Sapin et Wided Meflah</h5>
<p>Ce compte-rendu traite de la manière dont nous avons conçu la solution aux questions de ce TP ainsi que l’application technique de notre solution.</p>
<h2 id="description-du-problème-et-de-notre-approche">Description du problème et de notre approche</h2>
<p>Dans ce TP, nous nous plaçons dans le contexte de la réalisation d’une application pour vétérinaires. Nous allons employer la technologie Java RMI pour mettre en place un serveur avec lequel communiquent des clients, en l’occurrence nos hypothétiques vétérinaires, afin d’accéder à des données sur des animaux qui représenteront nos patients.</p>
<p>Nous avons choisi Eclipse pour réaliser ce TP. Pour répondre au problème, nous avons séparé le projet en trois : Un dossier pour le <strong>serveur</strong>, un autre pour le <strong>client</strong>, et un dernier nommé <strong>commons</strong>, dédié aux classes communes. Certains objets doivent être connus à la fois par le client et le serveur pour permettre une communication efficace entre les deux ; nous y reviendrons plus loin dans le TP.</p>
<p>Pour ce TP, la communication serveur &lt;-&gt; client sera simulée sur une même machine, d’un processus à l’autre, mais les mécanismes utilisés pourraient être mis en place sur un véritable réseau. Notre client et notre serveur communiquerons ici par via le port <strong>1099</strong>. Dans notre architecture distribuée, nous voulons que plusieurs clients puissent communiquer avec le même serveur en même temps. Ainsi, on pourra lancer plusieurs processus clients et constater qu’ils accèdent et modifient les mêmes ressources.</p>
<p><strong>PS :</strong> <em>Étant donné la progression du TP et l’évolution des consignes au fil des questions, les parties de code qui seront présentées dans le compte rendu ne figurent parfois pas dans le code final. Certaines ont également été modiifées ou simplifiées dans le rapport par souci de clarté.</em></p>
<h3 id="question-1">Question 1</h3>
<p>Nous développons ici notre première classe distribuée Animal, qui à ce stade se composera uniquement d’attributs simples.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>

	<span class="token keyword">protected</span> String owner_name<span class="token punctuation">;</span>
	<span class="token keyword">protected</span> String animal_name<span class="token punctuation">;</span>
	<span class="token keyword">protected</span> String species<span class="token punctuation">;</span>

<span class="token comment">//Des accesseurs comme getOwner_name() pour ces attributs sont également disponibles</span>
<span class="token comment">// etc.</span>
</code></pre>
<p>Cette classe est uniquement disponible côté serveur, le serveur va ainsi créer quelques instances d’Animal. Afin de rendre cette classe distribuée, on créée une interface Remote pour Animal qui s’appellera <strong>IAnimal</strong> et qui fera partie du dossier Commons, auquel le Client et le Serveur ont accès.</p>
<p>Cette interface va nous permettre de distribuer l’objet Animal et au client d’y accéder via le serveur : à l’aide de l’interface IAnimal, le client est capable de reconnaître l’existence de la classe et de ses méthodes, mais on ne lui donne pas accès à son code source. C’est en distribuant la classe Animal qu’on va lui permettre de demander au serveur d’exécuter des méthodes d’un objet Animal pour lui.</p>
<pre class=" language-java"><code class="prism  language-java">Animal animalDistribue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">"Jean"</span><span class="token punctuation">,</span> <span class="token string">"Félix"</span><span class="token punctuation">,</span> <span class="token string">"Chat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Registry registry <span class="token operator">=</span> LocateRegistry<span class="token punctuation">.</span><span class="token function">createRegistry</span><span class="token punctuation">(</span><span class="token number">1099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">"Félix"</span><span class="token punctuation">,</span> animalDistribue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>On ouvre un registre côté serveur sur le port 1099. Ce registre joue un rôle d’annuaire : on associe l’objet animalDistribue, ici Félix le chat, à une clé <em>“Félix”</em>. Grâce à cette clé, le client va pouvoir demander au serveur de lui fournir le stub de Félix. En simplifiant, ce stub va ouvrir un canal de communication entre le client et l’objet Félix du serveur.</p>
<pre class=" language-java"><code class="prism  language-java">Registry registry <span class="token operator">=</span> LocateRegistry<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
IAnimal stubAnimal <span class="token operator">=</span> <span class="token punctuation">(</span>IAnimal<span class="token punctuation">)</span> registry<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">"Félix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>On ajoute ensuite un gestionnaire de sécurité, en communiquant au serveur un fichier <em>java.security.policy</em> qui constitue les mesures de sécurité à mettre en place pour la communication.</p>
<pre class=" language-java"><code class="prism  language-java">String path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"java.security.policy"</span><span class="token punctuation">,</span> <span class="token string">"file:"</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">"/src/main/serveur.policy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>On décide ensuite d’enrichir la classe Animal avec un attribut de classe DossierSuivi, contenant un simple attribut String. On veut que le client puisse modifier le dossier de l’Animal. Or, à ce stade, la classe DossierSuivi n’est pas connue du client car ce n’est pas une classe distribuée, il n’y a donc pas directement accès.</p>
<p>Pour pouvoir modifier cet attribut, on va à la place coder un <em>setter</em> sur la classe Animal côté serveur, qui a quant à elle les droits d’accès nécessaires. Le client va ainsi appeler cette méthode via le stub, pour pouvoir modifier le DossierSuivi par l’intermédiaire de l’objet Animal. Le code côté client :</p>
<pre class=" language-java"><code class="prism  language-java">stubAnimal<span class="token punctuation">.</span><span class="token function">getDos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Même chose pour la nouvelle classe Espèce, un attribut de l’Animal, on ne souhaite pas ici que le client puisse la modifier. On va ainsi rendre cette classe sérialisable et non distribuée, c’est-à-dire que le client n’a pas d’accès direct à l’objet Espèce côté serveur, mais il peut en recevoir une copie via le stub d’Animal, qui est marshallée puis démarshallée. Il est important de noter que lorsque le client utilise la méthode getEspece() du stub, ce qu’il reçoit est une copie de l’attribut Espece <strong>et non une référence distante vers l’objet réel du serveur.</strong> C’est donc l’inverse de ce qui se passe pour l’objet Animal.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token comment">//Récupération d'une copie de l'attribut de classe espece de l'animal (PAS DE REFERENCE DISTANTE)</span>
		<span class="token comment">//La classe n'est pas distribuée car elle n'a pas d'interface remote</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==Test classe espèce=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>stub<span class="token punctuation">.</span><span class="token function">getAnimal_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" a pour espèce : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stub<span class="token punctuation">.</span><span class="token function">getInfo_espece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSpecies_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Espérance de vie "</span><span class="token operator">+</span>stub<span class="token punctuation">.</span><span class="token function">getInfo_espece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAverage_lifespan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="question-2">Question 2</h3>
<p>A partir de cette question, on change d’approche. La classe Animal ne sera plus distribuée via l’interface IAnimal et devient une classe du projet <strong>commons</strong>, ainsi que ses classes filles.</p>
<p>Nous allons désormais distribuer à la place une classe <strong>Cabinet</strong>. C’est avec elle que les vétérinaires interagiront via le processus client. Nous créons donc la classe <strong>CabinetRemote</strong> (ou bien ICabinet) en suivant le même principe que celui évoqué à la question 1. Les clients disposent donc maintenant d’un stub vers un objet Cabinet du serveur.</p>
<p>Cette classe implémente une liste chaînée d’Animaux qui représente les patients du cabinet vétérinaire. Ci-dessous la méthode de recherche d’un Animal dans le Cabinet, on fait ici usage de la méthode toString() de l’animal qui décrit ses caractéristiques.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> String <span class="token function">getPatient</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"CLIENT is requesting a search for "</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		String result<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>liste_de_patients<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				String actuel<span class="token punctuation">;</span>
				actuel <span class="token operator">=</span> liste_de_patients<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAnimal_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actuel<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					result <span class="token operator">=</span> result<span class="token operator">+</span><span class="token string">"Trouvé à l'indice "</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">" - "</span><span class="token operator">+</span>liste_de_patients<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">;</span>
					System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"	Match found at rank "</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{</span>
					System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"	"</span><span class="token operator">+</span>liste_de_patients<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAnimal_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" does not match "</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
<p>Cette méthode renvoie une String qui indique tous les endroits de la liste où le nom de l’animal a été trouvé, au cas où plusieurs animaux porteraient le même nom ce qui est fréquent. Grâce à la méthode toString() qui précise l’espèce et le propriétaire de l’animal, le vétérinaire peut trouver le bon animal sans risquer de le confondre avec un autre.</p>
<h3 id="question-3">Question 3</h3>
<p>On ajoute une méthode addAnimal() pour le Cabinet, qui peut soit prendre en paramètre un objet Animal, ou bien une liste de paramètres qui lui permettra de reconstruire directement l’Animal et de l’ajouter à la liste. C’est la deuxième configuration qui sera appelée du côté du client, comme ceci :</p>
<pre class=" language-java"><code class="prism  language-java">JavaClient<span class="token punctuation">.</span><span class="token function">addNewAnimal</span><span class="token punctuation">(</span>stub_cabinet<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">"Shaggy"</span><span class="token punctuation">,</span> <span class="token string">"Scoobydoo"</span><span class="token punctuation">,</span> <span class="token string">"Chien"</span><span class="token punctuation">,</span> <span class="token string">"RAS"</span><span class="token punctuation">,</span> <span class="token string">"Chien"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Les différentes données de l’animal sont ainsi transmises via le stub jusqu’au Cabinet du serveur, qui l’intègre à sa liste de patients. La méthode source du client est visible ci-dessous.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addNewAnimal</span><span class="token punctuation">(</span>CabinetRemote destinationClinic<span class="token punctuation">,</span> Animal beast<span class="token punctuation">)</span> <span class="token keyword">throws</span> RemoteException
	<span class="token punctuation">{</span>
		destinationClinic<span class="token punctuation">.</span><span class="token function">addAnimal</span><span class="token punctuation">(</span>beast<span class="token punctuation">.</span><span class="token function">getOwner_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beast<span class="token punctuation">.</span><span class="token function">getAnimal_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beast<span class="token punctuation">.</span><span class="token function">getSpecies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beast<span class="token punctuation">.</span><span class="token function">getDos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDossier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beast<span class="token punctuation">.</span><span class="token function">getInfo_espece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSpecies_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beast<span class="token punctuation">.</span><span class="token function">getInfo_espece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAverage_lifespan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
<h3 id="question-4">Question 4</h3>
<p>Nous implémentons pour cette question le mécanisme du <strong>codebase</strong>, qui constitue à fournir une adresse (sur le réseau ou sur la machine, dans notre cas) au serveur pour qu’il télécharge des classes du Client auxquelles il n’a pas naturellement accès. On lui donne l’accès, en l’occurrence, non pas au code source mais à la classe compilée.</p>
<p>Dans notre cas nous avons codé une classe fille Poisson, qui étend la classe Animal et qui possède en plus un attribut spécifiant le régime alimentaire du poisson. Le code source de cette classe est disponible uniquement chez le Client, et pour la suite du TP, le serveur a besoin de connaître cette classe. On stocke la version compilée de cette classe dans un répertoire Codebase qui contient un sous-dossier représentant le package source et le code compilé : <strong>Poisson.class</strong></p>
<pre class=" language-java"><code class="prism  language-java">String path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"java.rmi.server.codebase"</span><span class="token punctuation">,</span> <span class="token string">"file:"</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">"/../TP1_architecture_logicielle_CLIENT/codebase/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Nous essayons ensuite d’ajouter un Poisson au cabinet vétérinaire. Malheureusent, nous avons rencontré des problèmes à cette étape. Sans une bonne configuration du codebase, le code renvoie une erreur de <strong>class not found</strong> à la compilation. Nous avons réussi à configurer correctement le codebase de manière à ce que la classe Poisson soit reconnue par le serveur, mais nous ne sommes pas parvenus à ajouter directement un Poisson au Cabinet.</p>
<p>Lorsque nous avons tenté d’utiliser la méthode addAnimal() avec comme paramètre un Animal = new Poisson(), un animal a effectivement été ajouté au Cabinet, mais il utilisait systématiquement son constructeur de base au lieu d’employer les bons paramètres.</p>
<p>Le code final contourne donc ce problème en passant directement les paramètres nécessaires à la construction d’un objet Animal via le stub, ce qui fonctionne avec la classe Poisson. Mais en pratique, l’attribut <em>regimeAlimentaire</em> est perdu lors du transfert.</p>
<pre class=" language-java"><code class="prism  language-java">JavaClient<span class="token punctuation">.</span><span class="token function">addNewAnimal</span><span class="token punctuation">(</span>stub_cabinet<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Poisson</span><span class="token punctuation">(</span>ow1<span class="token punctuation">,</span> an1<span class="token punctuation">,</span> sp1<span class="token punctuation">,</span> <span class="token string">"RAS"</span><span class="token punctuation">,</span> sp1<span class="token punctuation">,</span> d1<span class="token punctuation">,</span> reg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Malgré ce revers, le code traite correctement le cas de l’ajout d’animal avec un objet de classe Poisson en paramètre, et le serveur a accès à la classe Poisson via le dossier <strong>codebase</strong> du Client, comme demandé.</p>
<h3 id="question-5">Question 5</h3>
<p>Pour la mise en place d’alertes, plusieurs solutions sont envisageables. Ou bien on distribue la classe Client elle-même afin que le serveur puisse faire appel à sa méthode, ou bien c’est le client lui-même qui va vérifier auprès du serveur, en consultant le Cabinet via le stub qu’il possède. Les deux approches ont leurs avantages et leurs inconvénients, dans notre cas nous avons choisi la seconde. L’avantage est que la communication Client -&gt; Serveur est simple et à sens unique, ainsi c’est le Client qui fait les requêtes et les appels de méthode sur les objets du serveur, qui se contente de répondre.</p>
<pre class=" language-java"><code class="prism  language-java">alarmQueries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span>Integer<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		triggeredAlarms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span>Boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		alarmQueries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		alarmQueries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		alarmQueries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		triggeredAlarms<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		triggeredAlarms<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		triggeredAlarms<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>On a donné au client deux listes chaînées, une d’entiers et une de booléens. La premièer correspond au seuil de patients auquel les alarmes se déclenchent, et la deuxième aux alarmes qui attendent encore d’être déclenchées. Ainsi, on évite de déclencher plusieurs fois une même alarme alors que le client a déjà été informé.</p>
<p>On a codé une fonction alarmTrigger() qui est appelée chez le client lorsqu’il essaie d’ajouter un patient. Il va alors vérifier si le cabinet a dépassé une certaine taille, auquel cas le client en sera averti.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">private</span> String <span class="token function">alarmTrigger</span><span class="token punctuation">(</span>CabinetRemote cabinet<span class="token punctuation">)</span> <span class="token keyword">throws</span> RemoteException <span class="token comment">//This returns the highest triggered alarm depending on the amount of animals in cabinet</span>
	<span class="token punctuation">{</span>
		String returnValue<span class="token operator">=</span><span class="token string">"Clear, no alarms"</span><span class="token punctuation">;</span>
		
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>alarmQueries<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cabinet<span class="token punctuation">.</span><span class="token function">countBeasts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>alarmQueries<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>triggeredAlarms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">false</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					returnValue<span class="token operator">=</span><span class="token string">"[ALARM] /!\\ Plus de "</span><span class="token operator">+</span>alarmQueries<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" patients: le cabinet accueille "</span><span class="token operator">+</span>cabinet<span class="token punctuation">.</span><span class="token function">countBeasts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" bêtes."</span><span class="token punctuation">;</span>
					triggeredAlarms<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> returnValue<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
<p>La boucle parcourt toutes les alarmes, puis si elles n’ont pas encore été déclenchées, on définit une alarme sur la String de retour qui sera affichée à l’appel de la fonction. Puisque cette boucle écrase la valeur à mesure qu’elle avance, cela permet de ne déclencher que la plus haute alerte auprès du client. Cela permet notamment d’éviter un affichage redondant du type :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token punctuation">[</span>ALARM<span class="token punctuation">]</span> <span class="token operator">/</span><span class="token operator">!</span>\ Plus de <span class="token number">6</span> patients <span class="token operator">!</span>
<span class="token punctuation">[</span>ALARM<span class="token punctuation">]</span> <span class="token operator">/</span><span class="token operator">!</span>\ Plus de <span class="token number">10</span> patients <span class="token operator">!</span>
<span class="token punctuation">[</span>ALARM<span class="token punctuation">]</span> <span class="token operator">/</span><span class="token operator">!</span>\ Plus de <span class="token number">100</span> patients <span class="token operator">!</span>
</code></pre>
<p>A la place, la console du client affichera seulement l’alerte pertinente :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token punctuation">[</span>ALARM<span class="token punctuation">]</span> <span class="token operator">/</span><span class="token operator">!</span>\ Plus de <span class="token number">100</span> patients <span class="token operator">!</span>
</code></pre>
<p>On pourrait néanmoins citer un point critiquable de cette implémentation dans la mesure où si de multiples clients sont connectés au serveur, ils n’auront peut-être pas tous simultanément l’alarme. Cependant, lors du démarrage du processus client ou lorsqu’ils interagissent avec le serveur, ils recevront l’alerte comme requis par l’énoncé.</p>
</div>
</body>

</html>
